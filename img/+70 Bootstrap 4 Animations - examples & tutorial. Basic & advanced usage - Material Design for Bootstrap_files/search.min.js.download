"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var Search=function(){function a(b,c,d){_classCallCheck(this,a),this.input=b,this.dropdown=c,this.data=[],this.jsonFile=d,this.searchValue="",this.keycodes=Object.freeze({ARROW_UP:38,ARROW_DOWN:40,ENTER:13,SLASH:191,ESCAPE:27})}return _createClass(a,[{key:"init",value:function b(){var a=this;fetch(this.jsonFile).then(function(a){return a.json()}).then(function(b){a.data=[].concat(_toConsumableArray(b)),a.bindEvents()})}},{key:"bindEvents",value:function b(){var a=this;this.input.addEventListener("input",function(b){return a.search(b)}),this.input.addEventListener("focus",function(b){0<b.target.value.length&&a.search(b)}),this.input.addEventListener("keydown",function(b){b.keyCode===a.keycodes.ARROW_DOWN&&0<a.options.length&&(b.preventDefault(),a.options[0].focus())}),window.addEventListener("click",function(b){a.visibleDropdown&&a.isOutside(b.target)&&a.toggleDropdown(!1)}),window.addEventListener("keydown",function(b){b.keyCode===a.keycodes.SLASH&&b.ctrlKey&&b.target!==a.input?(b.preventDefault(),a.input.focus()):b.keyCode===a.keycodes.ESCAPE&&a.visibleDropdown&&a.toggleDropdown(!1)})}},{key:"search",value:function b(a){this.searchValue=this.normalizeString(this.getSearchValue(a.target.value)),this.toggleDropdown(0<this.searchValue.length),this.renderResults(this.getResultsMarkup()),this.setupKeyboardNavigation()}},{key:"normalizeString",value:function b(a){return a.trim().toLowerCase()}},{key:"getSearchValue",value:function b(a){return 1<a.length&&"/"===a[0]?a.slice(1):a}},{key:"toggleDropdown",value:function c(a){var b=a?"block":"none";this.dropdown.style.display=b}},{key:"renderResults",value:function b(a){this.dropdown.innerHTML=a}},{key:"getResultsMarkup",value:function b(){var a=this;return this.results.map(function(b){return 0<a.searchValue.length&&b.description.match(a.searchValue),"\n        <a href=\""+b.link+"\">\n          "+a.highlightSearch(b.name)+"\n        </a>\n    "}).join("\n")}},{key:"compare",value:function d(a){var b=a.description,c=a.name;return"/"===this.searchValue||this.normalizeString(c).match(this.searchValue)||this.normalizeString(b).match(this.searchValue)}},{key:"sort",value:function c(a){var b=this;return[].concat(_toConsumableArray(a.filter(function(a){return 0===a.name.indexOf(b.searchValue)})),_toConsumableArray(a.filter(function(a){return 0<a.name.indexOf(b.searchValue)})),_toConsumableArray(a.filter(function(a){return 0>a.name.indexOf(b.searchValue)})))}},{key:"highlightSearch",value:function c(a){var b=this.normalizeString(a).indexOf(this.searchValue);return-1===b?a:a}},{key:"formatKeywords",value:function c(a){var b=this;return a.map(function(a){return b.highlightSearch(a)}).join(", ")}},{key:"setupKeyboardNavigation",value:function b(){var a=this;this.options.forEach(function(b,c){b.addEventListener("keydown",function(b){return a.focusNextOption(b,c)})})}},{key:"focusNextOption",value:function e(a,b){var c;if(a.keyCode===this.keycodes.ARROW_DOWN)c=1;else if(a.keyCode===this.keycodes.ARROW_UP)c=-1;else return;a.preventDefault();var d=b+c>this.options.length-1?0:0>b+c?this.options.length-1:b+c;this.options[d].focus()}},{key:"isOutside",value:function b(a){return a!==this.input&&(a===document.body||this.isOutside(a.parentNode))}},{key:"visibleDropdown",get:function a(){return"block"===this.dropdown.style.display}},{key:"options",get:function a(){return this.dropdown.getElementsByTagName("a")}},{key:"results",get:function c(){var a=this,b=this.data.filter(function(b){return a.compare(b)});return this.sort(b)}}]),a}();
